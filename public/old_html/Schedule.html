<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content= "width=device-width, initial-scale = 1"><!--what exactly doe this do?-->
    <title>Schedule a Session</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <!--<script src="/socket.io/socket.io.js"></script>-->

</head>

<body>
    <header role="banner">
        <h1>Tutors to Go</h1>
            <nav role="navigation">
            <ul class="my-topbanner">
                <li class="my-banneritem">
                    <div>
                        <a href="/" title="Home">Home</a>
                    </div>
                </li>
                
                <li class="my-banneritem my-dropdown">
                    <div>
                        <a class="my-dropbtn" href="/About" title="About">About</a>
                        <div class="my-dropdown-content">
                            <a href="/About#Who" title="Who We Are">Who We Are</a>
                            <a href="/About#What" title="What We Offer">What We Offer</a>
                            <a href="/About#Why" title="Why Us">Why Us</a>
                        </div>
                    </div>
                </li>
                
                <li class="my-banneritem my-dropdown">
                    <div>
                        <a class="my-dropbtn" href="/Schedule" title="Schedule a Session">Schedule a Session</a>
                    </div>
                </li>
                
                <li class="my-banneritem">
                    <div>
                        <a href="/ReviewPackets" title="Exam Review Packets">Exam Review Packets</a> 
                    </div>
                </li>
                
                <li class="my-banneritem">
                    <div>
                        <a href="/Careers" title="Job Opportunities">Job Opportunities</a>
                    </div>
                </li>
                
                <li class="my-banneritem my-dropdown">
                    <div>
                        <div class="my-dropbtn" title="Login/My Account">Login/My Account</div>
                        <div class="my-dropdown-content">
                            <a href="/StudentLogin" title="Login">Login</a>
                            <a href="/StudentCreate" title="Create Account">Create Account</a>
                        </div>
                    </div>
                </li>
                
                <li class="my-banneritem">
                    <div>
                        <a href="/Contact" title="Contact Us">Contact</a>
                    </div>
                </li>
            </ul>    
            </nav>
    </header>  

<div><!-- style="background-image: url('oldmain.jpeg');"-->
<main role="main">

<div class="container">
    <br>
    <div class="jumbotron">
        <h1 id="title" class="display-4">Schedule a Session</h1><!--the reason that this is lucida console is because it is h1 (styles.css)-->
            <div id="container"> <!--this is where the html will constantly be changed when things are submitted-->
                <br>
                <!--<form>-->
                    <select id="course" class="form-control">
                        <option>--Select a Course--</option>
                        <div>
                            <option id="ACCTG" class="course">ACCTG 211:</option></div>
                        <div>
                            <option id="BIOL" class="course">BIOL 110</option>
                            <option id="BIOL" class="course">BIOL 141</option></div>
                        <div>
                            <option id="CHEM" class="course">CHEM 110</option>
                            <option id="CHEM" class="course">CHEM 112</option></div>
                        <div>
                            <option id="CMPSC" class="course">CMPSC 122</option>
                            <option id="CMPSC" class="course">CMPSC 200</option>
                            <option id="CMPSC" class="course">CMPSC 201</option></div>
                        <div>
                            <option id="ECON" class="course">ECON 102</option>
                            <option id="ECON" class="course">ECON 104</option></div>
                        <div>
                            <option id="EDSGN">EDSGN 100</option></div>
                        <div>
                            <option id="EMCH" class="course">EMCH 210</option>
                            <option id="EMCH" class="course">EMCH 211</option>
                            <option id="EMCH" class="course">EMCH 212</option>
                            <option id="EMCH" class="course">EMCH 213</option></div>
                        <div>
                            <option id="ENGL" class="course">ENGL 15</option></div>
                        <div>
                            <option id="IST" class="course">IST 110</option></div>
                        <div>
                            <option id="MATH" class="course">MATH 21</option>
                            <option id="MATH" class="course">MATH 22</option>
                            <option id="MATH" class="course">MATH 26</option>
                            <option id="MATH" class="course">MATH 41</option>
                            <option id="MATH" class="course">MATH 110</option>
                            <option id="MATH" class="course">MATH 140 (A,B,E,G)</option>
                            <option id="MATH" class="course">MATH 141 (B,E,G)</option>
                            <option id="MATH" class="course">MATH 220</option>
                            <option id="MATH" class="course">MATH 230</option>
                            <option id="MATH" class="course">MATH 231</option>
                            <option id="MATH" class="course">MATH 232</option>
                            <option id="MATH" class="course">MATH 250, 251, or 252</option></div>
                        <div>
                            <option id="PHYS" class="course">PHYS 211</option>
                            <option id="PHYS" class="course">PHYS 212</option>
                            <option id="PHYS" class="course">PHYS 213</option>
                            <option id="PHYS" class="course">PHYS 214</option></div>
                        <div>
                            <option id="SPAN" class="course">SPAN 100</option>
                            <option id="SPAN" class="course">SPAN 200</option></div>
                    </select>
                    <br>
                    <input id="location" class="form-control" placeholder="Location" required>
                    <br>
                    <input id="time" class="form-control" placeholder="Time" required>
                    <br>
                    <button id="find" class="btn btn-success" style="background-color:darkblue; border-color: black;">Find a Tutor</button>
                    <!--<input type="submit" id="find" class="btn btn-success" style="background-color:darkblue; border-color: black;" value="Find a Tutor">-->
                <!--</form>-->
            </div>
</div>
<br>

</main>
</div>

<script>
    $('#find').click(() => {
        const request = {
            course: $('#course').val(),
            location: $('#location').val(),
            time: $('#time').val()
        }

        $.post('http://localhost:3000/Schedule', request, (tutors) => {
            updatePage(tutors);
        });
    });

    function updatePage(tutors) {
        $("#container").empty();
        console.log(tutors)
        if (tutors.length == 0) { //or tutors == null (it is not sending an array back, so this function wont work)
            $("#title").html(`Oops!`);
            $("#container").html(`
            <br>
            <div id="display-6">Sorry, it doesn't look like there aren't currently any tutors available for the course you selected. Please check back later.</div>
            <br>
            `);
        }

        else {
            $("#title").html(`Choose a Tutor`);

            $("#container").append(`
                <form id="form" action="/TutorSelect" method="POST">
                </form>
            `);

            tutors.forEach((tutor) => {
                console.log(tutor);
                $('#form').append(`
                    <br>
                    <input type="radio" name="tutor" value=${tutor.email}>${tutor.name}<br>
                `);
            });

            $("#form").append(`
                <br>
                <input type="submit" id="find" class="btn btn-success" style="background-color:darkblue; border-color: black;" value="Checkout">
            `);
        }
    }

                /*
            tutors.forEach((tutor) => {
                $('#temp').append(`
                    <br>
                    <div>${tutor.name}, ${tutor.rating}/10</div>
                `);
            });
            $("#temp").append(`
            <br>
            <button id="confirm" class="btn btn-success" style="background-color:darkblue; border-color: black;">Confirmation and Payment</button>
            <br>
            `);
            */
    
        /*    
    <h1 id="TutorSelect" class="display-4">Select a Tutor</h1>
        <div id="container"> <!--this is where the html will constantly be changed when things are submitted-->
            <br>
            <form id="form" action='/TutorSelect' method="POST">
                <input type="submit" id="find" class="btn btn-success" style="background-color:darkblue; border-color: black;" value="Checkout">
            </form>
        </div>
        */
    /*
    const socket = io("/Schedule");

    $('#find').click(() => { //disable the course and length option
        const course = $('#course').val(); 
        socket.emit('findTutors', course);
    });

    socket.on('availTutors', (tutors) => {
        if (tutors) {
            appendTutors(tutors);
        }

        noTutors();
    });

    function appendTutors(tutors) {
        $('#title').html('Choose a Tutor');
        $('#form').empty();
        tutors.array.forEach(element => {
            $('#form').append(`
                <br>
                <input id="tutor" type="radio" name="tutor" value=${element.name}>
            `) //change to the entire element for the server
        });
        $('#form').append(`<input type="submit" class="btn btn-success" style="background-color: darkblue" value="Confirm and Pay">`)
    }

    function noTutors(tutors) {

    }

    $("#form").submit(() => {
        const request = {
            tutor: $('#tutor').val(),
            course: course
        }
        $.post('/Schedule.html', request); //callback?
    })
    */
    /*
    $("#find").click(() => { //this will not work unless the server is running because it will not recognize socket and will shit itself
        console.log("Find a Tutor button has been clicked");
        let request = { course: $("#course").val(), location: $("#location").val() }; //it may be beneficial to make this var so i can have it for later
        console.log(request);
        findTutors(request);
    });

    function findTutors(request) {
        $.get('http://localhost:9000/tutors', request, (tutors) => {
            updatePage(tutors);
        });
    }

    function updatePage(tutors) {
        console.log(tutors);

        $("#temp").empty();
        if (tutors.length == 0) {
            $(".display-4").html(`Oops!`);
            $("#temp").html(`
            <br>
            <div>Sorry, it doesn't look like there are currently any tutors available for the course you selected. Please check back later.</div>
            <br>
        `);
        }

        else {
            $(".display-4").html(`Choose a Tutor`);
            tutors.forEach((tutor) => {
                $('#temp').append(`
                    <br>
                    <div>${tutor.name}, ${tutor.rating}/10</div>
                `);
            });
            $("#temp").append(`
            <br>
            <button id="confirm" class="btn btn-success" style="background-color:darkblue; border-color: black;">Confirmation and Payment</button>
            <br>
            `);
        }
    }
    */

    //I can use socket/polling to reupdate the page (by calling the findTutors function again) every half hour interval
    
    /*
    const socket = io("/Schedule");
  
    $("#find").click(() => { //this will not work unless the server is running because it will not recognize socket and will shit itself
        console.log("Find a Tutor button has been clicked");
        let request = { course: $("#course").val(), location: $("#location").val() };
        console.log(request);
        socket.emit("schedule", request);
    });

    socket.on("connect", () => {
        console.log("successful connection from the client");
    });

    socket.on("available", (tutors) => {
        console.log("available tutors successfully received by the client");
        console.log(tutors);
        //use these methods rather than .val(): only use that for form items
        $("#temp").empty();
        $(".display-4").html(`Choose a Tutor`);
        $("#temp").html(`
            <br>
            <div class="container bg-secondary">Tutor 1
            </div>
            <br>
            <div class="container bg-secondary">Tutor 2
            </div>
            <br>
            <button id="confirm" class="btn btn-success" style="background-color:darkblue; border-color: black;">Confirmation and Payment</button>
        `);

        //THIS PLACEMENT DOES WORK
        $("#confirm").click(() => {
            console.log("Tutor selected, user now proceeding to confirmation and payment");
            payment();
        });
    });

    //BUT THIS PLACEMENT DOES NOT WORK FOR SOME REASON
    $("#confirm").click(() => {
        console.log("Tutor selected, user now proceeding to confirmation and payment");
    });
    

    function payment() {
        console.log("payment function called");
    }
    */

</script>

<footer role="contentinfo" style="font-family: 'Lucida Sans', 'Lucida Sans Regular', 
    'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif">
        <h2 style="font-size: 150%">Contact Info</h2>
            <h3 style="font-size: 125%">Email: Tutors2GoStateCollege@gmail.com</h3>
            <h3 style="font-size: 125%">Phone: 410-830-0391 (Owner, Nicholas Evich)</h3>
</footer>

</body>
</html>